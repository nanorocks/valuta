<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="en" />
    <meta name='description'
        content='CSS & JavaScript minifier. We remove whitespace, strips, comments. For this app we use a few common programming patterns for optimizes/shortens.' />
    <meta name='keywords'
        content='css, js, javascript, minifier, shorten, optimize, minify, programming, coding, optimization, frontend, front-end' />

    <script src="https://kit.fontawesome.com/83fc83593c.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js"></script>
    <link rel="shortcut icon" href="icon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="CSS/skeleton.css">
    <link rel="stylesheet" href="CSS/custom.css">
    <title>Exchange rate </title>

    <!-- Global site tag (gtag.js) - Google Analytics -->


</head>

<body onload="LoadDropDownData()">
    
<!-- Navigation menu -->
<div class="container text-color">
        <div class="row">
                <div class="twelve columns">
                       <p class="u-pull-left">Currency exchange</p>
                       <p class="u-pull-right "><a class="language-link"href="#">MK</a>/<a class="language-link" href="#">ENG</a></p>
                       
                </div>
            
             </div>

     <div class="row">
        <div class="twelve columns">
                <ul class="navigation">
                    <li class="active"><a href="Index.html">List</a></li>
                    <li><a href="Konverter.html">converter</a></li>
                    <li><a href="Istorija.html">History</a></li>
                </ul>
        </div>
     </div>

     <div class="row">
        <div class="twelve columns" style="margin-top:2rem;margin-bottom:2rem;">
            <select class="u-full-width input-size" id="FromC" style="Color:black;" onchange="GetSelectedCurrency()">
              
              </select>
      </div>
            <div class="twelve columns">
                  <div id="chart" style="color:black"></div>
                  <div style="text-align:center">Denar history in the last 15 days.</div>
            </div>
         </div>
     

         <div class="row footer">
            <div class="twelve columns">
                <p class="u-pull-left"><a class="language-link"href="#">privacy policy </a></p>
                <p class="u-pull-right "><a class="language-link"href="#"><i class="fas fa-moon theme-active"></i></a>/
                  <a class="language-link" href="#"><i class="fas fa-sun"></i></a>
                </p>
          </div>
         
    
    </div>


</div>


<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>

async function LoadDropDownData()
{


  let response = await fetch("https://valuta.php.mk/api/list");

  if (response.ok) 
  { // if HTTP-status is 200-299
    // get the response body (see below)
    let json = await response.json();
    //console.log(json);
    data = json.data;
    FillDropDownData(data);

    
  } 
  else 
  {
    alert("HTTP-Error: " + response.status);
  }
}

function FillDropDownData(data)
{
  
  // get reference to select element
  var sel1 = document.getElementById('FromC');

  for(var i = 0;i<data.length;i++)
  {
    
     // create new option element
     var opt1 = document.createElement('option');

     // create text node to add to option element (opt)
     opt1.appendChild( document.createTextNode(data[i].oznaka) );
     // set value property of opt
     opt1.value = data[i].oznaka; 

     // add opt to end of select box (sel)
     sel1.appendChild(opt1); 

     
  }
  GetSelectedCurrency();
}

function GetSelectedCurrency()
{
  let chart = document.getElementById('chart');
  chart.innerHTML = '';
  var CurrencyOneSelect = document.getElementById("FromC");
  var CurrencyOneValue = CurrencyOneSelect.options[CurrencyOneSelect.selectedIndex].value;

  LoadChartData(CurrencyOneValue);
  
}


async function LoadChartData(CurrencyName)
{
  // https://valuta.php.mk/api/history/eur
  let QueryString = "https://valuta.php.mk/api/history/" + CurrencyName;

  let response = await fetch(QueryString);

  if (response.ok) 
  { // if HTTP-status is 200-299
    // get the response body (see below)
    let json = await response.json();
    console.log(json);
    RenderChart(json);

    
  } 
  else 
  {
    alert("HTTP-Error: " + response.status);
  }
}



  function RenderChart(HistoryData)
  {


    //Chart logic
    var options = {
      chart: {
        height: 450,
        type: 'line',
        zoom: {
          enabled: false
        },
      },
      dataLabels: {
        enabled: false
      },
      stroke: {
        width: [5, 7, 5],
        curve: 'straight',
        dashArray: [0, 8, 5]
      },
      series: [{
          name: "Kupoven",
          data: [HistoryData[0].kupoven,
                 HistoryData[1].kupoven,
                 HistoryData[2].kupoven,
                 HistoryData[3].kupoven,
                 HistoryData[4].kupoven,
                 HistoryData[5].kupoven,
                 HistoryData[6].kupoven,
                 HistoryData[7].kupoven,
                 HistoryData[8].kupoven,
                 HistoryData[9].kupoven,
                 HistoryData[10].kupoven,
                 HistoryData[11].kupoven,
                 HistoryData[12].kupoven,
                 HistoryData[13].kupoven,
                 HistoryData[14].kupoven
                 ]
        },
        {
          name: "Prodazen",
          data: [HistoryData[0].prodazen,
                 HistoryData[1].prodazen,
                 HistoryData[2].prodazen,
                 HistoryData[3].prodazen,
                 HistoryData[4].prodazen,
                 HistoryData[5].prodazen,
                 HistoryData[6].prodazen,
                 HistoryData[7].prodazen,
                 HistoryData[8].prodazen,
                 HistoryData[9].prodazen,
                 HistoryData[10].prodazen,
                 HistoryData[11].prodazen,
                 HistoryData[12].prodazen,
                 HistoryData[13].prodazen,
                 HistoryData[14].prodazen
                 ]
        },
        {
          name: 'Sreden',
          data: [HistoryData[0].sreden,
                 HistoryData[1].sreden,
                 HistoryData[2].sreden,
                 HistoryData[3].sreden,
                 HistoryData[4].sreden,
                 HistoryData[5].sreden,
                 HistoryData[6].sreden,
                 HistoryData[7].sreden,
                 HistoryData[8].sreden,
                 HistoryData[9].sreden,
                 HistoryData[10].sreden,
                 HistoryData[11].sreden,
                 HistoryData[12].sreden,
                 HistoryData[13].sreden,
                 HistoryData[14].sreden
                 ]
        }
      ],
      title: {
        text: 'History',
        align: 'left'
      },
      markers: {
        size: 0,

        hover: {
          sizeOffset: 6
        }
      },
      xaxis: {
        categories: [HistoryData[0].datum.slice(0, 10),
                 HistoryData[1].datum.slice(0, 10),
                 HistoryData[2].datum.slice(0, 10),
                 HistoryData[3].datum.slice(0, 10),
                 HistoryData[4].datum.slice(0, 10),
                 HistoryData[5].datum.slice(0, 10),
                 HistoryData[6].datum.slice(0, 10),
                 HistoryData[7].datum.slice(0, 10),
                 HistoryData[8].datum.slice(0, 10),
                 HistoryData[9].datum.slice(0, 10),
                 HistoryData[10].datum.slice(0, 10),
                 HistoryData[11].datum.slice(0, 10),
                 HistoryData[12].datum.slice(0, 10),
                 HistoryData[13].datum.slice(0, 10),
                 HistoryData[14].datum.slice(0, 10)
                 ],
      },
      tooltip: {
        y: [{
          title: {
            formatter: function (val) {
              return val + " (mins)"
            }
          }
        }, {
          title: {
            formatter: function (val) {
              return val + " per session"
            }
          }
        }, {
          title: {
            formatter: function (val) {
              return val;
            }
          }
        }]
      },
      grid: {
        borderColor: '#f1f1f1',
      }
    }

    var chart = new ApexCharts(
      document.querySelector("#chart"),
      options
    );

    chart.render();
  }

  
     

</script>
</body>

</html>